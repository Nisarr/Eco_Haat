<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Eco Haat</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/animations.css">

    <style>
        .products-page {
            padding-top: 100px;
            min-height: 100vh;
        }

        .products-header {
            background: var(--gradient-hero);
            padding: var(--space-3xl) 0;
            margin-bottom: var(--space-2xl);
        }

        .products-header__content {
            text-align: center;
            color: var(--text-white);
        }

        .products-header__title {
            color: var(--text-white);
            margin-bottom: var(--space-md);
        }

        .products-header__subtitle {
            color: var(--text-light);
            font-size: 1.125rem;
        }

        .products-filters {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
            margin-bottom: var(--space-xl);
            padding: var(--space-lg);
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-muted);
            margin-bottom: var(--space-xs);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-xl);
        }

        .products-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: var(--space-3xl);
        }

        .products-empty__icon {
            font-size: 4rem;
            margin-bottom: var(--space-lg);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: var(--space-sm);
            margin-top: var(--space-2xl);
        }

        .pagination__btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-light);
            background: var(--bg-card);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .pagination__btn:hover,
        .pagination__btn.active {
            background: var(--primary);
            color: var(--text-white);
            border-color: var(--primary);
        }

        .eco-slider {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .eco-slider input[type="range"] {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            background: var(--primary-pale);
            border-radius: 3px;
            outline: none;
        }

        .eco-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .eco-slider input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .eco-slider__value {
            font-weight: 600;
            color: var(--primary);
            min-width: 50px;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="navbar__container">
            <a href="../index.html" class="navbar__logo">
                <img src="../assets/images/logo.png" alt="Eco Haat" class="navbar__logo-img">
            </a>

            <ul class="navbar__nav" id="navMenu">
                <li><a href="../index.html" class="navbar__link">Home</a></li>
                <li><a href="products.html" class="navbar__link active">Products</a></li>
                <li><a href="../index.html#categories" class="navbar__link">Categories</a></li>
                <li><a href="../index.html#about" class="navbar__link">About</a></li>
            </ul>

            <div class="navbar__actions">
                <a href="cart.html" class="btn btn-icon navbar__cart" title="Shopping Cart">
                    üõí
                    <span class="navbar__cart-count" style="display: none;">0</span>
                </a>
                <a href="login.html" class="btn btn-secondary btn-sm" id="loginBtn">Login</a>
                <a href="register.html" class="btn btn-primary btn-sm" id="registerBtn">Join Now</a>
            </div>

            <button class="navbar__toggle" id="navToggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <main class="products-page">
        <!-- Header -->
        <div class="products-header">
            <div class="container">
                <div class="products-header__content">
                    <h1 class="products-header__title fade-in-up">Eco-Friendly Products</h1>
                    <p class="products-header__subtitle fade-in-up delay-1">
                        Discover sustainable alternatives for everyday life
                    </p>
                </div>
            </div>
        </div>

        <!-- Filters & Products -->
        <div class="container">
            <div class="products-filters">
                <div class="filter-group">
                    <label for="categoryFilter">Category</label>
                    <select id="categoryFilter" class="form-input form-select">
                        <option value="">All Categories</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="materialFilter">Material</label>
                    <select id="materialFilter" class="form-input form-select">
                        <option value="">All Materials</option>
                        <option value="bamboo">Bamboo</option>
                        <option value="paper">Paper</option>
                        <option value="clay">Clay</option>
                        <option value="jute">Jute</option>
                        <option value="wood">Wood</option>
                        <option value="cotton">Organic Cotton</option>
                        <option value="biodegradable">Biodegradable</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Min Eco Rating</label>
                    <div class="eco-slider">
                        <input type="range" id="ecoRating" min="0" max="100" value="0" step="5">
                        <span class="eco-slider__value" id="ecoRatingValue">0%</span>
                    </div>
                </div>

                <div class="filter-group">
                    <label for="searchInput">Search</label>
                    <input type="text" id="searchInput" class="form-input" placeholder="Search products...">
                </div>
            </div>

            <!-- Products Grid -->
            <div class="products-grid" id="productsGrid">
                <!-- Products loaded dynamically -->
                <div class="skeleton" style="height: 350px; border-radius: 16px;"></div>
                <div class="skeleton" style="height: 350px; border-radius: 16px;"></div>
                <div class="skeleton" style="height: 350px; border-radius: 16px;"></div>
                <div class="skeleton" style="height: 350px; border-radius: 16px;"></div>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination"></div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer" style="margin-top: var(--space-3xl);">
        <div class="container">
            <div class="footer__bottom">
                <p class="footer__copyright">¬© 2024 Eco Haat. Made with üíö for the planet.</p>
            </div>
        </div>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Scripts -->
    <script src="../js/config.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        let currentPage = 1;
        const pageSize = 12;

        document.addEventListener('DOMContentLoaded', async () => {
            // Check auth status and update navbar
            updateNavbar();

            // Load categories for filter
            await loadCategories();

            // Load products
            await loadProducts();

            // Set up filters
            setupFilters();

            // Check URL params for category
            const urlParams = new URLSearchParams(window.location.search);
            const categoryParam = urlParams.get('category');
            if (categoryParam) {
                // Set category filter based on URL param
                const categoryFilter = document.getElementById('categoryFilter');
                // This would need to map the category slug to ID
            }
        });

        function updateNavbar() {
            const user = API.getUser();
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');

            if (user) {
                loginBtn.textContent = user.full_name || 'Account';
                loginBtn.href = user.role === 'seller' ? '../seller/index.html' :
                    user.role === 'admin' ? '../admin/index.html' : 'orders.html';
                registerBtn.textContent = 'Logout';
                registerBtn.href = '#';
                registerBtn.onclick = async (e) => {
                    e.preventDefault();
                    await API.logout();
                    window.location.reload();
                };

                Utils.updateCartBadge();
            }
        }

        async function loadCategories() {
            try {
                const categories = await API.getCategories();
                const select = document.getElementById('categoryFilter');

                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = `${cat.icon || ''} ${cat.name}`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Failed to load categories:', error);
            }
        }

        async function loadProducts() {
            const grid = document.getElementById('productsGrid');

            // Get filter values
            const categoryId = document.getElementById('categoryFilter').value;
            const material = document.getElementById('materialFilter').value;
            const minEcoRating = document.getElementById('ecoRating').value;
            const search = document.getElementById('searchInput').value;

            // Build params
            const params = {
                page: currentPage,
                page_size: pageSize
            };

            if (categoryId) params.category_id = categoryId;
            if (material) params.material = material;
            if (parseInt(minEcoRating) > 0) params.min_eco_rating = minEcoRating;
            if (search) params.search = search;

            try {
                const products = await API.getProducts(params);

                if (products.length === 0) {
                    grid.innerHTML = `
                        <div class="products-empty">
                            <div class="products-empty__icon">üå±</div>
                            <h3>No Products Found</h3>
                            <p style="color: var(--text-muted);">
                                Try adjusting your filters or check back later for new eco-friendly products!
                            </p>
                        </div>
                    `;
                    return;
                }

                grid.innerHTML = products.map(product => Utils.generateProductCard(product)).join('');

                // Add click handlers
                grid.querySelectorAll('.product-card').forEach(card => {
                    card.style.cursor = 'pointer';
                    card.addEventListener('click', () => {
                        const productId = card.dataset.productId;
                        window.location.href = `product-detail.html?id=${productId}`;
                    });
                });

            } catch (error) {
                console.error('Failed to load products:', error);
                grid.innerHTML = `
                    <div class="products-empty">
                        <div class="products-empty__icon">‚ö†Ô∏è</div>
                        <h3>Unable to Load Products</h3>
                        <p style="color: var(--text-muted);">
                            Please check your connection and try again.
                        </p>
                        <button class="btn btn-primary mt-lg" onclick="loadProducts()">
                            Retry
                        </button>
                    </div>
                `;
            }
        }

        function setupFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            const materialFilter = document.getElementById('materialFilter');
            const ecoRating = document.getElementById('ecoRating');
            const ecoRatingValue = document.getElementById('ecoRatingValue');
            const searchInput = document.getElementById('searchInput');

            // Update eco rating display
            ecoRating.addEventListener('input', () => {
                ecoRatingValue.textContent = `${ecoRating.value}%`;
            });

            // Apply filters on change
            const applyFilters = Utils.debounce(() => {
                currentPage = 1;
                loadProducts();
            }, 300);

            categoryFilter.addEventListener('change', applyFilters);
            materialFilter.addEventListener('change', applyFilters);
            ecoRating.addEventListener('change', applyFilters);
            searchInput.addEventListener('input', applyFilters);
        }
    </script>
</body>

</html>